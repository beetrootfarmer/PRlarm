name: PR Review Reminder

on:
  schedule:
    # í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë§¤ ì‹œê°„ ì‹¤í–‰ (ì‹¤ì œ ì‚¬ìš© ì‹œ ì¡°ì • í•„ìš”)
    - cron: "0 * * * *"
  # ìˆ˜ë™ ì‹¤í–‰ ì˜µì…˜ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)
  workflow_dispatch:

jobs:
  remind:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get pending PRs
        id: pending-prs
        uses: actions/github-script@v6
        with:
          script: |
            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open'
            });

            let message = "ğŸ“‹ *ë¦¬ë·° ëŒ€ê¸° ì¤‘ì¸ PR ëª©ë¡*\n\n";
            let hasPRs = false;

            for (const pr of prs.data) {
              if (pr.requested_reviewers && pr.requested_reviewers.length > 0) {
                hasPRs = true;
                const reviewers = pr.requested_reviewers
                  .map(r => r.login ? r.login : (r.slug ? `íŒ€: ${r.slug}` : 'ì•Œ ìˆ˜ ì—†ëŠ” ë¦¬ë·°ì–´'))
                  .join(', ');
                message += `â€¢ <${pr.html_url}|#${pr.number}: ${pr.title}> - ë¦¬ë·°ì–´: ${reviewers}\n`;
              }
            }

            if (!hasPRs) {
              message += "í˜„ì¬ ë¦¬ë·° ëŒ€ê¸° ì¤‘ì¸ PRì´ ì—†ìŠµë‹ˆë‹¤.ğŸ™Œ";
            }

            core.setOutput('message', message);
            core.setOutput('has_prs', hasPRs.toString());

            // ë””ë²„ê¹…ì„ ìœ„í•´ ì½˜ì†”ì— ì¶œë ¥
            console.log(message);

      - name: Send Slack notification
        uses: slackapi/slack-github-action@v1.24.0
        with:
          channel-id: "C08JG1LKT44" # ìŠ¬ë™ ì±„ë„ ID
          slack-message: ${{ steps.pending-prs.outputs.message }}
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
